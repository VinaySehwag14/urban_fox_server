<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Fox - Database Schema</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-top: 0;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 4px;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸ¦Š Urban Fox E-Commerce - Database Schema</h1>

        <div class="info">
            <strong>ðŸ“Š Entity Relationship Diagram</strong>
            <p>This diagram shows all database tables and their relationships. You can zoom and pan the diagram below.
            </p>
        </div>

        <div class="mermaid">
            erDiagram
            users {
            TEXT id PK
            VARCHAR name
            VARCHAR email
            VARCHAR phone
            BOOLEAN is_verified
            TIMESTAMP created_at
            }

            admin_users {
            UUID id PK
            VARCHAR name
            VARCHAR email
            TEXT password
            VARCHAR role
            TIMESTAMP created_at
            }

            categories {
            UUID id PK
            VARCHAR name
            VARCHAR slug
            TEXT description
            UUID parent_id FK
            TEXT image_url
            BOOLEAN is_active
            TIMESTAMP created_at
            }

            products {
            SERIAL id PK
            VARCHAR name
            VARCHAR slug
            TEXT description
            VARCHAR qikink_sku
            VARCHAR brand
            NUMERIC mrp
            NUMERIC selling_price
            INT discount_percent
            BOOLEAN is_featured
            BOOLEAN is_active
            TIMESTAMP created_at
            }

            product_categories {
            INT product_id FK
            UUID category_id FK
            }

            product_images {
            SERIAL id PK
            INT product_id FK
            TEXT image_url
            BOOLEAN is_primary
            INT display_order
            }

            tags {
            SERIAL id PK
            VARCHAR name
            }

            product_tags {
            INT product_id FK
            INT tag_id FK
            }

            product_variants {
            SERIAL id PK
            INT product_id FK
            VARCHAR sku_code
            VARCHAR color
            VARCHAR size
            INT stock_quantity
            NUMERIC price_override
            TEXT image_url
            BOOLEAN is_active
            }

            cart_items {
            SERIAL id PK
            TEXT user_id FK
            INT variant_id FK
            INT quantity
            }

            liked_products {
            TEXT user_id FK
            INT product_id FK
            }

            orders {
            SERIAL id PK
            TEXT user_id FK
            NUMERIC total_amount
            NUMERIC discount_amount
            NUMERIC final_amount
            VARCHAR status
            VARCHAR razorpay_order_id
            VARCHAR razorpay_payment_id
            VARCHAR qikink_order_id
            INT coupon_id FK
            JSONB shipping_address
            TIMESTAMP created_at
            }

            order_items {
            SERIAL id PK
            INT order_id FK
            INT variant_id FK
            VARCHAR product_name
            JSONB variant_details
            NUMERIC price
            INT quantity
            }

            payments {
            SERIAL id PK
            INT order_id FK
            VARCHAR payment_gateway
            VARCHAR payment_status
            VARCHAR payment_reference
            NUMERIC amount
            VARCHAR payment_method
            TIMESTAMP paid_at
            }

            coupons {
            SERIAL id PK
            VARCHAR code
            VARCHAR type
            NUMERIC value
            NUMERIC min_cart_value
            NUMERIC max_discount
            TIMESTAMP start_date
            TIMESTAMP end_date
            INT usage_limit
            INT times_used
            BOOLEAN is_active
            }

            user_coupons {
            TEXT user_id FK
            INT coupon_id FK
            BOOLEAN used
            TIMESTAMP used_at
            }

            reviews {
            SERIAL id PK
            TEXT user_id FK
            INT product_id FK
            INT rating
            TEXT comment
            BOOLEAN is_verified_purchase
            TIMESTAMP created_at
            }

            users ||--o{ orders : "places"
            users ||--o{ cart_items : "adds"
            users ||--o{ liked_products : "likes"
            users ||--o{ reviews : "writes"
            users ||--o{ user_coupons : "uses"

            admin_users ||--o{ products : "manages"

            products ||--o{ product_variants : "has"
            products ||--o{ product_images : "includes"
            products ||--o{ product_categories : "belongs_to"
            products ||--o{ product_tags : "tagged_with"
            products ||--o{ reviews : "reviewed_by"
            products ||--o{ liked_products : "liked_by"

            product_variants ||--o{ cart_items : "in_cart"
            product_variants ||--o{ order_items : "purchased_in"

            categories ||--o{ product_categories : "organizes"
            tags ||--o{ product_tags : "labels"

            orders ||--o{ order_items : "contains"
            orders ||--|| payments : "paid_with"
            orders ||--o{ coupons : "uses_coupon"

            coupons ||--o{ user_coupons : "claimed_by"
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 4px;">
            <h3>ðŸ“‹ Database Statistics</h3>
            <ul>
                <li><strong>Total Tables:</strong> 15</li>
                <li><strong>Core Entities:</strong> Users, Products, Orders, Payments</li>
                <li><strong>Support Tables:</strong> Categories, Tags, Reviews, Coupons</li>
                <li><strong>Junction Tables:</strong> product_categories, product_tags, user_coupons, liked_products
                </li>
            </ul>

            <h3>ðŸ”— Key Relationships</h3>
            <ul>
                <li>Products â†’ Variants (One-to-Many)</li>
                <li>Products â†” Categories (Many-to-Many via product_categories)</li>
                <li>Orders â†’ Order Items â†’ Variants (Order line items)</li>
                <li>Orders â†’ Payments (One-to-One)</li>
                <li>Users â†’ Cart Items â†’ Variants (Shopping cart)</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            er: {
                layoutDirection: 'TB',
                fontSize: 14,
                useMaxWidth: true
            }
        });
    </script>
</body>

</html>